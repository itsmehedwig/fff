<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Library Management System{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/loading.css' %}">
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <div class="loading-text" id="loading-text">Loading...</div>
            <div class="loading-subtext loading-pulse" id="loading-subtext">Please wait</div>
        </div>
    </div>

    {% if user.is_authenticated %}
    <nav class="bg-blue-600 text-white shadow-lg fixed w-full z-50 transition-transform duration-300"
         x-data="{ mobileMenuOpen: false, lastScroll: 0, hidden: false }"
         x-init="
            if('{{ user.user_type }}' === 'pos') {
                window.addEventListener('scroll', () => {
                    let currentScroll = window.pageYOffset;
                    hidden = currentScroll > lastScroll && currentScroll > 100;
                    lastScroll = currentScroll;
                });
            }
         "
         :class="{ '-translate-y-full': hidden && '{{ user.user_type }}' === 'pos' }">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <!-- Logo -->
            <div class="flex items-center space-x-3">
                {% if system_settings.system_logo %}
                    <img src="{{ system_settings.system_logo.url }}" alt="Logo" class="h-8 w-8 object-contain">
                {% else %}
                    <i class="fas fa-book text-2xl"></i>
                {% endif %}
                <span class="text-xl font-bold">{{ system_settings.system_name|default:"Library System" }}</span>
            </div>
            
            <!-- Desktop Menu -->
            <div class="hidden md:flex items-center space-x-6">
                {% if user.user_type == 'student' %}
                    <a href="{% url 'student_dashboard' %}" class="hover:text-blue-200 transition"><i class="fas fa-home mr-2"></i>Dashboard</a>
                    <a href="{% url 'student_books' %}" class="hover:text-blue-200 transition"><i class="fas fa-book mr-2"></i>Books</a>
                    <a href="{% url 'student_settings' %}" class="hover:text-blue-200 transition"><i class="fas fa-cog mr-2"></i>Settings</a>
                {% elif user.user_type == 'admin' %}
                    <a href="{% url 'admin_dashboard' %}" class="hover:text-blue-200 transition"><i class="fas fa-home mr-2"></i>Dashboard</a>
                    <a href="{% url 'manage_books' %}" class="hover:text-blue-200 transition"><i class="fas fa-book mr-2"></i>Books</a>
                    <a href="{% url 'manage_students' %}" class="hover:text-blue-200 transition"><i class="fas fa-users mr-2"></i>Students</a>
                    <a href="{% url 'manage_librarians' %}" class="hover:text-blue-200 transition"><i class="fas fa-user-tie mr-2"></i>Librarians</a>
                    <a href="{% url 'admin_logs' %}" class="hover:text-blue-200 transition"><i class="fas fa-clipboard-list mr-2"></i>Logs</a>
                    <a href="{% url 'admin_settings' %}" class="hover:text-blue-200 transition"><i class="fas fa-cog mr-2"></i>Settings</a>
                {% elif user.user_type == 'librarian' %}
                    <a href="{% url 'librarian_dashboard' %}" class="hover:text-blue-200 transition"><i class="fas fa-home mr-2"></i>Dashboard</a>
                    <a href="{% url 'manage_books' %}" class="hover:text-blue-200 transition"><i class="fas fa-book mr-2"></i>Books</a>
                    <a href="{% url 'manage_students' %}" class="hover:text-blue-200 transition"><i class="fas fa-users mr-2"></i>Students</a>
                    <a href="{% url 'pending_transactions' %}" class="hover:text-blue-200 transition"><i class="fas fa-clock mr-2"></i>Pending</a>
                {% elif user.user_type == 'pos' %}
                    <a href="{% url 'pos_home' %}" class="hover:text-blue-200 transition"><i class="fas fa-home mr-2"></i>Home</a>
                {% endif %}
                <a href="{% url 'logout' %}" class="hover:text-blue-200 transition"><i class="fas fa-sign-out-alt mr-2"></i>Logout</a>
            </div>

            <!-- Mobile Hamburger Button -->
            <button @click="mobileMenuOpen = !mobileMenuOpen" class="md:hidden text-white focus:outline-none">
                <i class="fas text-2xl" :class="mobileMenuOpen ? 'fa-times' : 'fa-bars'"></i>
            </button>
        </div>

        <!-- Mobile Menu -->
        <div x-show="mobileMenuOpen" 
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 transform scale-95"
             x-transition:enter-end="opacity-100 transform scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 transform scale-100"
             x-transition:leave-end="opacity-0 transform scale-95"
             class="md:hidden mt-4 pb-2">
            <div class="flex flex-col space-y-2">
                {% if user.user_type == 'student' %}
                    <a href="{% url 'student_dashboard' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-home mr-2"></i>Dashboard</a>
                    <a href="{% url 'student_books' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-book mr-2"></i>Books</a>
                    <a href="{% url 'student_settings' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-cog mr-2"></i>Settings</a>
                {% elif user.user_type == 'admin' %}
                    <a href="{% url 'admin_dashboard' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-home mr-2"></i>Dashboard</a>
                    <a href="{% url 'manage_books' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-book mr-2"></i>Books</a>
                    <a href="{% url 'manage_students' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-users mr-2"></i>Students</a>
                    <a href="{% url 'manage_librarians' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-user-tie mr-2"></i>Librarians</a>
                    <a href="{% url 'admin_logs' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-clipboard-list mr-2"></i>Logs</a>
                    <a href="{% url 'admin_settings' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-cog mr-2"></i>Settings</a>
                {% elif user.user_type == 'librarian' %}
                    <a href="{% url 'librarian_dashboard' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-home mr-2"></i>Dashboard</a>
                    <a href="{% url 'manage_books' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-book mr-2"></i>Books</a>
                    <a href="{% url 'manage_students' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-users mr-2"></i>Students</a>
                    <a href="{% url 'pending_transactions' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-clock mr-2"></i>Pending</a>
                {% elif user.user_type == 'pos' %}
                    <a href="{% url 'pos_home' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-home mr-2"></i>Home</a>
                {% endif %}
                <a href="{% url 'logout' %}" class="hover:bg-blue-700 px-4 py-2 rounded transition"><i class="fas fa-sign-out-alt mr-2"></i>Logout</a>
            </div>
        </div>
    </nav>
    {% endif %}

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-4 md:py-8 flex-1 mt-20">
        {% if messages %}
            {% for message in messages %}
                <div class="mb-4 p-3 md:p-4 rounded-lg text-sm md:text-base {% if message.tags == 'error' %}bg-red-100 text-red-700{% elif message.tags == 'success' %}bg-green-100 text-green-700{% else %}bg-blue-100 text-blue-700{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white text-center py-4 text-sm md:text-base mt-auto">
        <p>&copy; 2025 {{ system_settings.system_name|default:"Library Management System" }}. All rights reserved.</p>
    </footer>
    
    <script src="{% static 'js/loading.js' %}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
